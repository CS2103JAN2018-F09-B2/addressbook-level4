# hoangduong1607
###### /java/seedu/recipe/ui/CommandBox.java
``` java

    /**
     * Moves caret to the next field in input text.
     * If no field is found after current position, continue from beginning of input text.
     */
    private void moveToNextField() {
        int currentCaretPosition = commandTextArea.getCaretPosition();
        int nextFieldPosition = autoCompletionUtil.getNextFieldPosition(commandTextArea.getText(),
                currentCaretPosition);
        commandTextArea.positionCaret(nextFieldPosition);
    }

    /**
     * Automatically fills command box with text generated by auto-completion
     */
    protected void autoComplete(String text) {
        String prefix = commandTextArea.getText().substring(0, commandTextArea.getCaretPosition());
        String suffix = commandTextArea.getText().substring(commandTextArea.getCaretPosition());

        textInputProcessor.setContent(prefix);

        String autoCompletionText;
        int caretPosition;
        if (autoCompletionUtil.isCommandKeyWord(text)) {
            autoCompletionText = autoCompletionUtil.getAutoCompletionText(text);
            caretPosition = text.length() + 1;
        } else {
            autoCompletionText = textInputProcessor.replaceLastWord(text);
            caretPosition = autoCompletionText.length();
            autoCompletionText = autoCompletionText + suffix;
        }

        replaceText(autoCompletionText);
        commandTextArea.positionCaret(caretPosition);
    }

```
###### /java/seedu/recipe/ui/util/AutoCompletionUtil.java
``` java

/**
 * Contains constants and functions needed for auto-completion
 */
public class AutoCompletionUtil {
    public static final ArrayList<String> APPLICATION_COMMANDS = new ArrayList<>(Arrays.asList("add", "clear", "delete",
            "edit", "exit", "find", "help", "history", "list", "redo", "select", "share", "tag", "undo", "upload"));
    public static final ArrayList<String> APPLICATION_KEYWORDS = new ArrayList<>(Arrays.asList(
            CliSyntax.PREFIX_NAME.toString(), CliSyntax.PREFIX_INGREDIENT.toString(),
            CliSyntax.PREFIX_INSTRUCTION.toString(), CliSyntax.PREFIX_PREPARATION_TIME.toString(),
            CliSyntax.PREFIX_TAG.toString(), CliSyntax.PREFIX_URL.toString()));
    public static final int MAX_SUGGESTIONS = 8;
    public static final char LF = '\n';
    public static final char WHITESPACE = ' ';
    public static final char END_FIELD = '/';

    private HashMap<String, ArrayList<String>> prefixesForCommand;

    public AutoCompletionUtil() {
        prefixesForCommand = new HashMap<>();

        ArrayList<String> addPrefixes = new ArrayList<>(Arrays.asList(CliSyntax.PREFIX_NAME.toString(),
                CliSyntax.PREFIX_INGREDIENT.toString(), CliSyntax.PREFIX_INSTRUCTION.toString(),
                CliSyntax.PREFIX_PREPARATION_TIME.toString(), CliSyntax.PREFIX_TAG.toString(),
                CliSyntax.PREFIX_URL.toString()));
        prefixesForCommand.put("add", addPrefixes);

        ArrayList<String> editPrefixes = new ArrayList<>(Arrays.asList(CliSyntax.PREFIX_NAME.toString(),
                CliSyntax.PREFIX_INGREDIENT.toString(), CliSyntax.PREFIX_INSTRUCTION.toString(),
                CliSyntax.PREFIX_PREPARATION_TIME.toString(), CliSyntax.PREFIX_TAG.toString(),
                CliSyntax.PREFIX_URL.toString()));
        prefixesForCommand.put("edit", editPrefixes);

        for (String command : APPLICATION_COMMANDS) {
            if (!command.equals("add") && !command.equals("edit")) {
                prefixesForCommand.put(command, new ArrayList<>());
            }
        }
    }

    /**
     * Checks whether {@code text} is a command keyword
     */
    public boolean isCommandKeyWord(String text) {
        return prefixesForCommand.containsKey(text);
    }

    /**
     * Generates auto-completed command
     */
    public String getAutoCompletionText(String command) {
        String autoCompletionText = command;

        for (String prefix : prefixesForCommand.get(command)) {
            autoCompletionText = autoCompletionText + WHITESPACE + LF + prefix;
        }

        return autoCompletionText;
    }

    /**
     * Finds position of next field.
     * Returns current position of caret if no field is found
     */
    public int getNextFieldPosition(String inputText, int currentCaretPosition) {
        int nextFieldCaretPosition = currentCaretPosition;

        for (int i = 0; i < inputText.length(); i++) {
            int wrapAroundPosition = (i + currentCaretPosition) % inputText.length();

            if (inputText.charAt(wrapAroundPosition) == END_FIELD) {
                nextFieldCaretPosition = wrapAroundPosition + 1;
                break;
            }
        }

        return nextFieldCaretPosition;
    }
}
```
###### /java/seedu/recipe/ui/util/TextInputProcessorUtil.java
``` java

/**
 * Provides basic functions for processing text input
 */
public class TextInputProcessorUtil {

    private static final String EMPTY_STRING = "";
    private static final char LF = '\n';
    private static final char SPACE = ' ';

    private String content;
    private Font font;
    private Text text;

    public TextInputProcessorUtil() {
        content = new String();
        text = new Text();
    }

    /**
     * Gets X-coordinate of caret
     */
    public double getCaretPositionX() {
        Text lastLine = new Text(getTextWithoutLastWord(getLastLine()));
        lastLine.setFont(font);
        return lastLine.prefWidth(-1);
    }

    /**
     * Gets Y-coordinate of caret
     */
    public double getCaretPositionY() {
        return text.prefHeight(-1);
    }

    /**
     * Gets last word from {@code content}
     */
    public String getLastWord() {
        String lastWord = EMPTY_STRING;

        for (int i = content.length() - 1; i >= 0; i--) {
            if (isWordSeparator(content.charAt(i))) {
                break;
            }
            lastWord = content.charAt(i) + lastWord;
        }

        return lastWord;
    }

    /**
     * Checks whether {@code inputChar} is a word separator
     */
    private boolean isWordSeparator(char inputChar) {
        return (inputChar == LF || inputChar == SPACE);
    }

    /**
     * Gets last line from {@code content}
     */
    public String getLastLine() {
        String lastLine = new String("");

        for (int i = content.length() - 1; i >= 0; i--) {
            if (isLineSeparator(content.charAt(i))) {
                break;
            }
            lastLine = content.charAt(i) + lastLine;
        }

        return lastLine;
    }

    /**
     * Checks whether {@code inputChar} is a line separator
     */
    private boolean isLineSeparator(char inputChar) {
        return (inputChar == LF);
    }

    /**
     * Gets the resulting text after replacing last word of {@code content} with {@code newLastWord}
     */
    public String replaceLastWord(String newLastWord) {
        return getTextWithoutLastWord() + newLastWord;
    }

    /**
     * Gets the resulting text after removing last word from {@code content}
     */
    public String getTextWithoutLastWord() {
        int newLength = content.length() - getLastWord().length();
        return content.substring(0, newLength);
    }

    /**
     * Gets the resulting text after removing last word from {@code inputText}
     */
    public String getTextWithoutLastWord(String inputText) {
        int newLength = inputText.length() - getLastWord().length();
        return inputText.substring(0, newLength);
    }

    /**
     * Sets content in TextInputProcessor to {@code inputText}
     */
    public void setContent(String inputText) {
        content = inputText;
        text.setText(inputText);
        text.setFont(font);
    }

    /**
     * Sets font of content in TextInputProcessor to {@code font}
     */
    public void setFont(Font inputFont) {
        font = inputFont;
    }
}
```
###### /java/seedu/recipe/ui/SuggestionsPopUp.java
``` java

/**
 * The component that is responsible for showing a suggestion list for auto-completion
 */
public class SuggestionsPopUp extends ContextMenu {

    private CommandBox commandBox;
    private TextArea commandTextArea;
    private TextInputProcessorUtil textInputProcessor;

    protected SuggestionsPopUp(CommandBox commandBox) {
        super();
        this.commandBox = commandBox;
        commandTextArea = commandBox.getCommandTextArea();
        textInputProcessor = new TextInputProcessorUtil();
    }

    /**
     * Hides suggestions
     */
    protected void hideSuggestions() {
        if (isShowing()) {
            hide();
        }
    }

    /**
     * Shows suggestions for commands when users type in Command Box
     */
    protected void showSuggestions() {
        String prefix = commandTextArea.getText().substring(0, commandTextArea.getCaretPosition());
        textInputProcessor.setContent(prefix);
        textInputProcessor.setFont(commandTextArea.getFont());
        String lastWord = textInputProcessor.getLastWord();
        // finds suggestions and displays
        ArrayList<String> suggestionList = new ArrayList<>(APPLICATION_KEYWORDS);
        suggestionList.addAll(APPLICATION_COMMANDS);

        findSuggestions(lastWord, suggestionList);

        // gets caret position based on input text and font
        double anchorX = findDisplayPositionX(textInputProcessor.getCaretPositionX());
        double anchorY = findDisplayPositionY(textInputProcessor.getCaretPositionY());

        show(commandTextArea, Side.BOTTOM, anchorX, anchorY);
    }

    /**
     * Finds possible suggestions from {@code word} and
     * list of valid suggestions {@code textList}.
     */
    private void findSuggestions(String prefix, List<String> dictionary) {
        getItems().clear();
        Collections.sort(dictionary);

        for (String suggestion : dictionary) {
            if (suggestion.startsWith(prefix)) {
                addSuggestion(suggestion);
            }

            if (getItems().size() == MAX_SUGGESTIONS) {
                break;
            }
        }
    }

    /**
     * Finds X-coordinate to display SuggestionsPopUp in CommandBox
     */
    double findDisplayPositionX(double caretPositionX) {
        return commandBox.getRoot().getLayoutX() + commandTextArea.getInsets().getLeft() + caretPositionX;
    }

    /**
     * Finds Y-coordinate to display SuggestionsPopUp in CommandBox
     */
    double findDisplayPositionY(double caretPositionY) {
        return Math.min(-commandTextArea.getHeight() + commandTextArea.getInsets().getTop()
                + commandTextArea.getInsets().getBottom() + caretPositionY, -commandTextArea.getInsets().getBottom());
    }

    /**
     * Adds a suggestion to suggestion list
     */
    private void addSuggestion(String suggestion) {
        MenuItem item = new MenuItem(suggestion);
        item.setOnAction(event -> commandBox.autoComplete(item.getText()));
        getItems().add(item);
    }
}
```
